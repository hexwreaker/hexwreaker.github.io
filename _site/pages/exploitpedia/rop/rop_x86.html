<!DOCTYPE html>
<html lang="en">
<head class="page-header" role="banner">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hexwreaker Expoitpedia</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <canvas id="container"></canvas>
    <script src="/script.js"></script>

    <div id="main" class="main-content" role="main">
        <div id="nav-bar">
            <div id="nav-home" class="nav-item"><a href="/"><img src="/src/images/home.jpg"/></a></div>
        </div>
        <h4 id="exploitpedia"><a href="/pages/exploitpedia/exploitpedia">ExploitPedia</a></h4>

<h1 id="rop-x86">ROP-x86</h1>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Cible : x86 32bit
</code></pre></div></div>

<h2 id="présentation">Présentation</h2>

<p>La technique du ROP (Return Oriented Programming) consiste à se servir de “gadgets” présents dans le binaire afin de contrôler le flot d’exécution du processus.
Les gadgets sont assemblés dans une “Ropchain” et sont utilisés par les instructions <strong>ret</strong>, successivement.</p>

<p>Le ROP permet de controuner l’<strong>ASLR</strong> et le <strong>NX</strong> (W xor X).</p>

<p>Le buffer overflow permet à l’attaquant de réecrire l’adresse de retour de <strong>main</strong>, seulement. Il doit donc contrôler une seconde zone mémoire afin d’y placer sa <strong>ropchain</strong>.</p>

<p>Une technique appelée <strong>“stack pivoting”</strong> est nécessaire afin que l’attaquant puisse écrire toute la ropchain dans le buffer global <strong>name</strong>. En effet, ce buffer n’est pas assez grand opur contenir la ropchain complète.
Le <strong>stack pivoting</strong> consiste à controler la <strong>stack frame</strong> du processus afin d’appeler à plusieurs reprises la fonction <strong>read</strong>. 
Elle s’appuie sur le double appel à l’instruction <strong>“leave ; ret”</strong>, ce qui permet de contrôler les valeurs des registres <strong>rbp</strong> et <strong>rsp</strong>.</p>

<p>Grâce à cette technique l’attaquant peut assembler la ropchain en plusieurs fois. Voir : https://ir0nstone.gitbook.io/notes/binexp/stack/stack-pivoting</p>

<p>Voici la ropchain finale qui assemble la ropchain en mémoire et contrôle la stack frame avec les instructions <strong>leave</strong> et <strong>ret</strong>.</p>

    </div>
</body>
</html>
