---
layout: default
title: Hexwreaker Expoitpedia
---
#### [ExploitPedia](/pages/exploitpedia/exploitpedia)

# Format strings precision writing

## Présentation

voir : [Format string](/pages/exploitpedia/format_strings/format_strings_overflow)

Il est possible d'écrire à un endroit précis dans la mémoire en utilisant le formatteur : **"%n"** et **"%hn"** (sa variante pour 2 octets).
Ils permettent d'écrire le nombre **N** de caractères précédemment affichés à l'endroit pointé par l'argument.

Par exemple, pour écrire la valeur **0x080484cb** à l'adresse **0x080498ae** :

```python
pld  = p32(0x080498ae)
pld += p32(0x080498ac)
pld += b"%2044x%4$hn"      # écrit la valeur  2044+8    (0x0804) dans 0x080498ae
pld += b"%31943x%5$hn"     # écrit la valeur 31943+2052 (0x84cb) dans 0x080498ac
```

# Exemple

Pour ce qui est de l'environnement d'exploitation, il n'y a aucune protections. L'exploitation est réalisée à distance, en envoyant un payload. La taille de la chaîne formattée **output** ne peut pas dépassé 1023 octets, ce qui impose à l'attaquant de s'adapter.

L'objectif est de réecrire une adresse de la section **got.plt**. qui pointe vers le shellcode en pile. La fonction réecrite choisie est : **send()**. Cette technique s'appelle : [Got overwriting](/pages/exploitpedia/techniques/got_overwriting).


Le payload comprend d'abord les adresses des 4 octets de la got.plt de **send()**. La taille maximale de 1023 octets force l'attaquant à réecrire octet par octet la cible, en utilisant le formateur **%hhn** et non pas **%n**.

Ensuite il y a les formateurs : 

    %1$Xid %Y$hhn

dont la première partie consiste à écrire Xi caractères et la seconde à écrire le nombre de caractère total écrit depuis le début à l'adresse du Yème argument.

Puis vient le shellcode précédé d'un NOPsled. Le shellcode consiste à converger les entrées et sorties standards (**stdin, stdout, stderr**) vers le socket du client (**csock**) avant d'appeler **execve("/bin//sh")**.

